# DHCP Server
Основная цель протокола [DHCP](https://datatracker.ietf.org/doc/html/rfc2131) - назначение и получение IP-адресов в локальных сетях

## Запуск сервера
```shell
python3 dhcp/dhcp_sever.py
```

Порт сервера: `67`, порт клиента: `68`

## Поля DHCP пакета:
* `OP` - тип сообщения (1 байт)
* `HTYPE` - тип аппаратного адреса (1 байт)
* `HLEN` - длина аппаратного адреса в байтах (1 байт)
* `HOPS` - кол-во промежуточных маршрутизаторов (1 байт)
* `XID` - уникальный идентификатор транзакции (4 байта)
* `SECS` - время в секундах с начала процесса получения адреса (2 байта)
* `FLAGS` - поле для флагов (2 байта)
* `CIADDR` - IP-адрес клиента, если он есть (4 байта)
* `YIADDR` - новый IP-адрес клиента в OFFER (4 байта)
* `SIADDR` - IP-адрес сервера (4 байта)
* `GIADDR` - IP-адрес агента ретранслятора (4 байта)
* `CHADDR` - аппаратный адрес клиента (обычно MAC) (16 байт)
* `SNAME` - необязательное имя сервера (64 байта)
* `FILE` - необязательное имя файла на сервере (192 байта)
* `OPTIONS` - различные дополнительные параметры конфигурации. В начале поля всегда указывается "волшебное число" (99,130,83,99)


Протокол подразумевает несколько стадий:
1. DHCPDISCOVER (Client -> Server)
2. DHCPOFFER (Server -> Client)
3. DHCPREQUEST (Client -> Server)
4. DHCPACK (Server -> Client)



# DNS Client
[DNS](https://datatracker.ietf.org/doc/html/rfc1035) - протокол для сопоставления IP-адресов и доменных имён.


## Запуск клиента
```shell
python3 dns/client_start.py
```
После запуска клиента запросы к DNS серверу `8.8.8.8` отправляются по принципу
```
<Тип запроса>
<Доменное имя>
``` 

То есть в консоли пишется тип запроса, ставится символ новой строки, после чего пишется доменное имя.


# Поля DNS пакета

* ID - 16 бит. Идентификатор запроса.


* QR - Размер 1 бит. Указывает, запрос это или ответ.


* Opcode - 4 бита. Указывает на тип запроса из приведённых ниже:
  - 0 - стандартный запрос (QUERY),
  - 1 - инверсивный запрос (IQUERY),
  - 2 - запрос состояния сервера (STATUS),
  - 3-15 - зарезервировано.
  

* Флаги AA, TC, RD, RA - Размер 1 бит.
  - AA - Authoritative Answer
  - TC - Truncation
  - RD - Recursion Desired
  - RA - Recursion Available


* Z - 3 бита. Зарезервировано. Должен быть 0.


* RCODE - 4 бита. Указывает на код ответа из приведённых ниже:
  - 0 - ошибок нет;
  - 1 - Ошибка формата. Сервер не смог интерпретировать запрос;
  - 2 - Ошибка сервера. Сервер не смог обработать запрос из-за проблем;
  - 3 - Ошибка имени. Доменное имя, указанное в запросе, не существует;
  - 4 - Не реализовано. Указывает, что сервер не поддерживает запрошенный тип запроса;
  - 5 - Отказано. Сервер отказывается выполнить указанную операцию по соображениям политики.


* QDCOUNT - 16 бит. Целое число без знака, определяющее количество записей в разделе запроса.


* ANCOUNT - 16 бит. Целое число без знака, определяющее количество записей в разделе ответа.


* NSCOUNT - 16 бит. Целое число без знака, определяющее количество записей в разделе авторитетных записей.


* ARCOUNT - 16 бит. Целое число без знака, определяющее количество записей в разделе дополнительных записей.


* QNAME - Имя домена. Представляется в виде последовательности меток, где в каждой метке идёт сначала байт длины, 
а затем следует такое количество байтов. Это поле заканчивается нулевым байтом.


* QTYPE - 2 байта. Определяет тип запроса. В данной реализации используются следующие типы запроса:
  - 1 - A
  - 15 - MX
  - 16 - TXT
  - 28 - AAAA


* QCLASS - 2 байта. Определяет класс запроса. В данной реализации используется класс запроса IN.


* NAME - Имя домена, записанное в таком же формате, что и QNAME в разделе запроса.
Полученное число - ссылка на байт пакета, откуда следует считать доменное имя.

* TYPE - Аналогичен QTYPE.

* CLASS - Аналогичен QCLASS.

* TTL - 32 бита. Целое число без знака, указывающее на время в секундах, в течение которого запись может быть кэширована.

* RDLENGTH - 16 бит. Целое число без знака в байтах, указывающее длину поля RDATA.

* RDATA - Имеет переменный размер. Описывает ресурс. Формат зависит от TYPE и CLASS.


# Demo

## DHCP
### Сервер
```
/usr/local/bin/python3.9 /Users/dmitry.nazarov/dev/computer_networks/UDP_protocol/dhcp/dhcp_server.py
Wait DHCP discovery.
Receive DHCP discovery.
b'\x02\x01\x06\x009\x03\xf3&\x00\x00\x00\x00\x00\x00\x00\x00\xc0\xa8\x01d\xc0\xa8\x01\x01\x00\x00\x00\x00\x00\x05<\x04\x8dY\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00c\x82Sc5\x01\x05\x01\x04\xff\xff\xff\x00\x03\x04\xc0\xa8\x01\x013\x04\x00\x01Q\x806\x04\xc0\xa8\x01\x01'
Send DHCP offer.
Wait DHCP request.
Receive DHCP request.
Send DHCP ack.

Wait DHCP discovery.
```

### Клиент
```
/usr/local/bin/python3.9 /Users/dmitry.nazarov/dev/computer_networks/UDP_protocol/dhcp/dhcp_test_client.py
DHCP client is starting...

Send DHCP discovery.
Receive DHCP offer.
Send DHCP request.
Receive DHCP pack.


Process finished with exit code 0
```


## DNS
```
Usage: enter Resource Record Type (A, AAAA, MX, TXT) and domain name
A
yandex.ru

Results for A-query yandex.ru: 4
1.	5.255.255.55
2.	77.88.55.70
3.	5.255.255.50
4.	77.88.55.66
AAAA
yandex.ru

Results for AAAA-query yandex.ru: 1
1.	2a:02:06:b8:00:0a:00:00
MX
yandex.ru

Results for MX-query yandex.ru: 1
1.	mx.yandex.ru
TXT
yandex.ru

Results for TXT-query yandex.ru: 0
A
google.com

Results for A-query google.com: 6
1.	209.85.233.100
2.	209.85.233.138
3.	209.85.233.113
4.	209.85.233.139
5.	209.85.233.102
6.	209.85.233.101
AAAA
google.com
(cache) Results for AAAA-query google.com: 4
1.	2a:00:14:50:40:10:0c:07
2.	00:01:00:00:01:2c:00:10
3.	00:00:00:64:c0:0c:00:1c
4.	40:10:0c:07:00:00:00:00
```